<html>

<meta charset="UTF-8">

<head>
  <!-- 下面这一行引入jQuery库，不要更改 -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <link href="c3.min.css" rel="stylesheet">
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="c3.min.js"></script>
  <script src="calculator.js"></script>
  <script src="c3_chart.js"></script>
</head>

<body>

<h1>World of Warships AP penetration calculator alpha 0.33</h1>

<p>This is a test version based on US NAVY penetration formula and game file data mining.</p>


<p>shiplist：
<select id="file_to_read" onchange="load_value();">
  <option value="cruiser">cruisers</option>
  <option value="battleship">battleships</option>
  <option value="destroyer">destroyers</option>
</select>
</p>

<p><textarea id="value_loaded"></textarea></p>

<p>shiplist：<select id="shiplist" onchange="ammo_properties();"></select></p>

<p>Ammo name: <div id="ammo_selected_name"></div>
Air Drag Coeff: <div id="ammo_selected_airdrag"></div>
Caliber <div  id="ammo_selected_diametr"></div>
Mass <div  id="ammo_selected_mass"></div>
Krupp <div id="ammo_selected_krupp"></div>
Muzzle Velocity: <div id="ammo_selected_speed"></div></p>

<div id="chart"></div>

<script>

var ship_info;
  function load_value() {
    file_selector = $("#file_to_read")[0];
    selected_filename = file_selector.options[file_selector.selectedIndex].value;
    $.ajax({
      url: selected_filename+".json",
      type: "GET",
      dataType: "json",
      success: function (data) {
          ship_info=data
          select_from_keys(Object.keys(data))
          //alert(Object.keys(data))
          console.log(Object.keys(data))
          $("#value_loaded")[0].innerHTML = Object.keys(data)
          ammo_properties();
          //console.log(pen_dict.distance);

      }
    });
  }

  load_value();  // 在页面载入的时候读取默认的文件中的内容

    function select_from_keys(data) {

      $("#shiplist").replaceWith("<select id=\"shiplist\" onchange=\"ammo_properties();\"></select>");  // replace the old select with a new empty select
      for(var i in data) {
        $("#shiplist")[0].innerHTML += "<option value=\"" + data[i] + "\">" + data[i] + "</options>";  // append option
      }
    }

    function ammo_properties(){
      // display ammo information
      ship_selector = $("#shiplist")[0];
      ship_name = ship_selector.options[ship_selector.selectedIndex].value;
      selected_ship=ship_info[ship_name]
      console.log(selected_ship.AP.bulletAirDrag)
      var c_D,Dia,mass,krupp,v_0;
      c_D=selected_ship.AP.bulletAirDrag;
      Dia=selected_ship.AP.bulletDiametr;
      mass=selected_ship.AP.bulletMass;
      krupp=selected_ship.AP.bulletKrupp;
      v_0=selected_ship.AP.bulletSpeed;
      $("#ammo_selected_name")[0].innerHTML = selected_ship.AP.bulletName;
      $("#ammo_selected_airdrag")[0].innerHTML = selected_ship.AP.bulletAirDrag;
      $("#ammo_selected_diametr")[0].innerHTML = selected_ship.AP.bulletDiametr;
      $("#ammo_selected_mass")[0].innerHTML = selected_ship.AP.bulletMass;
      $("#ammo_selected_krupp")[0].innerHTML = selected_ship.AP.bulletKrupp;
      $("#ammo_selected_speed")[0].innerHTML = selected_ship.AP.bulletSpeed;

      // draw ammo penetration curve
      pen_dict= calculator(mass,Dia,c_D,v_0,krupp);
      update_chart(pen_dict);
    }

</script>
